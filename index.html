<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GeoJSON Overlay with OpenLayers</title>
  <!-- Load OpenLayers CSS from jsdelivr CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@6.15.1/ol.css">
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    #map { width: 100%; height: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>
  <!-- Load OpenLayers JS from jsdelivr CDN -->
  <script src="https://cdn.jsdelivr.net/npm/ol@6.15.1/ol.js"></script>
  <script>
    // Ensure OpenLayers has loaded
    if (!window.ol) {
      console.error('OpenLayers library not found. Did the CDN load correctly?');
    }

    // Style for GeoJSON layers (semi-transparent red fill, red stroke)
    const geojsonStyle = new ol.style.Style({
      fill: new ol.style.Fill({ color: 'rgba(255, 0, 0, 0.5)' }),
      stroke: new ol.style.Stroke({ color: 'red', width: 2 })
    });

    // Function to create a vector layer from GeoJSON URL
    function createGeojsonLayer(url) {
      return new ol.layer.Vector({
        source: new ol.source.Vector({
          url: url,
          format: new ol.format.GeoJSON()
        }),
        style: geojsonStyle
      });
    }

    // Instantiate GeoJSON layers
    const layerSE = createGeojsonLayer('simplified_SE.geojson');
    const layerSW = createGeojsonLayer('simplified_SW.geojson');
    const layerNE = createGeojsonLayer('simplified_NE.geojson');
    const layerNW = createGeojsonLayer('simplified_NW.geojson');

    // Base OpenStreetMap tile layer
    const osmLayer = new ol.layer.Tile({ source: new ol.source.OSM() });

    // Initialize the map
    const map = new ol.Map({
      target: 'map',
      layers: [osmLayer, layerSE, layerSW, layerNE, layerNW],
      view: new ol.View({ center: [0, 0], zoom: 2 })
    });

    // Fit view once all GeoJSON sources are ready
    const sources = [layerSE.getSource(), layerSW.getSource(), layerNE.getSource(), layerNW.getSource()];
    let readyCount = 0;
    sources.forEach(src => {
      src.on('change', () => {
        if (src.getState() === 'ready') {
          readyCount++;
          if (readyCount === sources.length) {
            // Compute and fit to combined extent
            const combinedExtent = ol.extent.createEmpty();
            sources.forEach(s => ol.extent.extend(combinedExtent, s.getExtent()));
            map.getView().fit(combinedExtent, { padding: [50, 50, 50, 50] });
          }
        }
      });
    });
  </script>
</body>
</html>
