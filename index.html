<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prohibitive Camping Areas in NH's White Mountains</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.6.0/ol.css">
  <style>
    html, body { margin: 0; padding: 0; height: 100%; display: flex; flex-direction: column; }
    #title { text-align: center; padding: 10px; font-family: sans-serif; font-size: 1.5em; }
    #map { flex: 1; }
    #legend { padding: 10px; background: #f9f9f9; font-family: sans-serif; }
    #legend h3 { margin-top: 0; }
    #legend ul { margin: 0; padding-left: 20px; }
  </style>
</head>
<body>
  <div id="title">Prohibitive Camping Areas in NH's White Mountains</div>
  <div id="map"></div>
  <div id="legend">
    <h3>Camping Regulations</h3>
    <ul>
      <li>Camp at least <strong>200 ft</strong> from trails and water bodies.</li>
      <li>Camp at least <strong>1/4 mile</strong> from backcountry facilities (shelters, huts, trailheads).</li>
      <li>No camping in the alpine zone (trees ≤8 ft) except when ≥2 ft of snow cover.</li>
      <li>Camp at least <strong>1/4 mile</strong> from designated roads.</li>
    </ul>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/ol@v10.6.0/dist/ol.js"></script>
  <script>
    window.onload = function() {
      // Validate OpenLayers global
      if (typeof ol === "undefined") {
        console.error("OpenLayers library not found. Make sure the script src is correct and served over HTTP/HTTPS.");
        return;
      }

      // Common style for GeoJSON layers
      const geojsonStyle = new ol.style.Style({
        fill: new ol.style.Fill({ color: 'rgba(255, 0, 0, 0.5)' }),
        stroke: new ol.style.Stroke({ color: 'red', width: 2 })
      });

      // Factory for vector layers
      function createGeojsonLayer(url) {
        return new ol.layer.Vector({
          source: new ol.source.Vector({ url: url, format: new ol.format.GeoJSON() }),
          style: geojsonStyle
        });
      }

      // Define the Esri World Topographic Map basemap
      const esriTopoBasemap = new ol.layer.Tile({
        source: new ol.source.XYZ({
          attributions: 'Tiles &copy; <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer">Esri</a>',
          url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}',
          maxZoom: 19
        })
      });

      // Define layers, starting with the Esri basemap
      const layers = [
        esriTopoBasemap,
        createGeojsonLayer('simplified_SE.geojson'),
        createGeojsonLayer('simplified_SW.geojson'),
        createGeojsonLayer('simplified_NE.geojson'),
        createGeojsonLayer('simplified_NW.geojson')
      ];

      // Initialize map
      const map = new ol.Map({
        target: 'map',
        layers: layers,
        view: new ol.View({
          // Center on Mount Washington (approximately 44.27 N, -71.30 W)
          center: ol.proj.fromLonLat([-71.30, 44.27]),
          zoom: 12 // Adjusted zoom level for Mount Washington area
        })
      });

      // Fit map to combined extent of GeoJSON layers
      const sources = layers.slice(1).map(l => l.getSource());
      let readyCount = 0;
      sources.forEach(src => {
        src.on('change', () => {
          if (src.getState() === 'ready') {
            readyCount++;
            if (readyCount === sources.length) {
              const extent = ol.extent.createEmpty();
              sources.forEach(s => ol.extent.extend(extent, s.getExtent()));
              if (!ol.extent.isEmpty(extent)) {
                map.getView().fit(extent, { padding: [50, 50, 50, 50], duration: 1000 });
              }
            }
          }
        });
      });
    };
  </script>
</body>
</html>
