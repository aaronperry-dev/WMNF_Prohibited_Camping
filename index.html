<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prohibitive Camping Areas in NH's White Mountains</title>

  <link href="https://fonts.googleapis.com/css2?family=Arial:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Georgia:wght@700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.6.0/ol.css">

  <style>
    /* Base Layout and New Theme Backgrounds */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      /* Existing Flexbox for layout (for map to fill height) */
      display: flex;
      flex-direction: column;
      /* New Theme Body Styles */
      background-image: url('contours.jpg'); /* New theme background */
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      font-family: 'Helvetica', 'Arial', sans-serif; /* New theme font family */
      line-height: 1.6;
    }

    /* New Theme Banner */
    #top-banner {
      background-image: url('chocorua_lake_banner.jpg'); /* Banner image */
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      width: 100%;
      height: 100px; /* Adjust height as needed */
    }

    /* New Theme Navbar - Start */
    #menu {
      background: #4061A6;
      height: 45px;
      border-radius: 0px;
    }
    #menu ul, #menu li {
      margin: 0 auto;
      padding: 0;
      list-style: none
    }
    #menu ul {
      width: 100%;
      text-align: left;
    }
    #menu li {
      display: inline-block;
      position: relative;
    }
    #menu a {
      display: block;
      line-height: 45px;
      padding: 0 14px;
      text-decoration: none;
      color: #FFFFFF;
      font-size: 16px;
    }
    #menu a.dropdown-arrow:after {
      content: "\25BE";
      margin-left: 5px;
    }
    #menu li a:hover {
      color: #EBB700;
      background: #F2F2F2;
    }
    #menu input {
      display: none;
      margin: 0;
      padding: 0;
      height: 45px;
      width: 100%;
      opacity: 0;
      cursor: pointer
    }
    #menu label {
      display: none;
      line-height: 45px;
      text-align: center;
      position: absolute;
      left: 35px
    }
    #menu label:before {
      font-size: 1.6em;
      color: #FFFFFF;
      content: "\2261";
      margin-left: 20px;
    }
    #menu ul.sub-menus{
      height: auto;
      overflow: hidden;
      width: 170px;
      background: #444444;
      position: absolute;
      z-index: 99;
      display: none;
    }
    #menu ul.sub-menus li {
      display: block;
      text-align: left;
      width: 100%;
    }
    #menu ul.sub-menus a {
      color: #FFFFFF;
      font-size: 16px;
    }
    #menu li:hover ul.sub-menus {
      display: block
    }
    #menu ul.sub-menus a:hover{
      background: #F2F2F2;
      color: #444444;
    }
    /* New Theme Navbar - End */

    /* Title Section - Adjusted for new theme */
    #title {
      text-align: center;
      padding: 15px 10px; /* Increased padding slightly */
      background-color: rgba(255, 255, 255, 0.85); /* Added semi-transparent background */
      margin: 0; /* Remove margin from previous iteration */
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #title h1 {
      /* New theme h1 style */
      font-size: 2.2em; /* Slightly larger for main title */
      margin: 0; /* Override previous margin */
      color: #000000;
      font-weight: bold;
      font-family: 'Helvetica', 'Arial', sans-serif;
    }
    #title h2 {
      /* New theme h2 style */
      font-size: 1.2em; /* Adjusted for explanation text */
      margin: 10px 0 0; /* Adjusted margin */
      color: #4061A6;
      font-family: 'Georgia Bold', 'Arial', serif;
    }
    #title h2:after {
      /* New theme h2 underline effect */
      content:' ';
      color: #4061A6;
      background-color: #4061A6;
      display:block;
      border:0.5px solid #000000;
      border-radius:1px;
      -webkit-border-radius:4px;
      -moz-border-radius:4px;
      box-shadow:inset 0 1px 1px rgba(0, 0, 0, .05);
      -webkit-box-shadow:inset 0 1px 1px rgba(0, 0, 0, .05);
      -moz-box-shadow:inset 0 1px 1px rgba(0, 0, 0, .05);
      width: 80%; /* Adjusted width for the underline */
      margin: 5px auto 0; /* Centered */
    }

    /* Main content area containing map and legend */
    #main-content {
      flex: 1; /* Allows this container to grow and fill available space */
      display: flex;
      flex-direction: column;
      position: relative; /* For map's absolute positioning of search/tooltip */
      padding-bottom: 30px; /* Space for the fixed footer */
      overflow: auto; /* Allows content to scroll if it exceeds viewport height */
    }

    #map {
      flex: 1; /* Keep map flexible */
      min-height: 400px; /* Ensure a minimum height for the map */
      width: 100%;
      position: relative; /* Keep for search/tooltip overlays */
    }

    /* Legend - Adjusted for new theme (h3 specifically) */
    #legend {
      padding: 15px; /* Increased padding */
      background: rgba(255, 255, 255, 0.85); /* Semi-transparent background */
      font-family: 'Helvetica', 'Arial', sans-serif; /* Match body font */
      box-shadow: 0 -2px 5px rgba(0,0,0,0.1); /* Subtle shadow */
      margin-top: 10px; /* Space from map */
    }
    #legend h3 {
      text-align: left;
      margin: 10px 0;
      color: #4061A6;
      font-family: 'Georgia Bold', 'Arial', serif;
    }
    #legend ul { margin: 0; padding-left: 20px; }


    /* Search Bar Styling (Desktop/Default) - MERGED & Adjusted */
    #search-container {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background-color: rgba(255, 255, 255, 0.9);
      padding: 8px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      gap: 5px;
      width: 280px;
      box-sizing: border-box;
    }
    #search-input-group {
        display: flex;
        gap: 5px;
    }
    #search-input {
      border: 1px solid #ccc;
      padding: 6px 10px;
      font-size: 1em;
      border-radius: 3px;
      flex-grow: 1;
    }
    #search-button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 1em;
      flex-shrink: 0;
    }
    #search-button:hover {
      background-color: #0056b3;
    }
    #search-results {
        width: 100%;
        background-color: white;
        border: 1px solid #ccc;
        border-radius: 0 0 5px 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        max-height: 200px;
        overflow-y: auto;
        display: none;
        z-index: 999;
    }
    #search-results ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    #search-results li {
        padding: 8px 10px;
        cursor: pointer;
        border-bottom: 1px solid #eee;
    }
    #search-results li:last-child {
        border-bottom: none;
    }
    #search-results li:hover {
        background-color: #f0f0f0;
    }

    /* Coordinate Tooltip Styling */
    #coordinate-tooltip {
      position: absolute;
      background: white;
      color: black;
      padding: 5px 8px;
      border-radius: 3px;
      white-space: nowrap;
      font-size: 0.85em;
      pointer-events: none;
      display: none;
      transform: translate(-50%, -100%);
      margin-top: -10px;
      border: 1px solid #ccc;
      font-family: 'Helvetica', 'Arial', sans-serif; /* Match new theme font */
    }

    /* New Theme Footer - Fixed */
    #footer {
      background: #4061A6;
      color: white;
      text-align: center;
      padding: 5px;
      position: fixed;
      bottom: 0;
      width: 100%;
      height: 20px;
      font-size: 14px;
      font-weight: bold;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    /* Additional Theme Styles (Tables, etc.) - Not directly used on this page, but included for consistency */
    #hike-info { margin: 20px auto; max-width: 90%; background-color: rgba(255, 255, 255, 0.8); padding: 20px; border-radius: 10px;}
    table { width: 100%; border-collapse: collapse; font-family: 'Roboto', sans-serif; }
    th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
    th { background-color: #4061A6; color: #FFFFFF;; font-weight: 600; }
    tbody tr:nth-child(even) {
    background-color: #4061A6;
    color: #ffffff;
    }
    tbody tr:hover {
    background-color: #f0f0f0;
    color: #000000;
    }
    tfoot {
    font-weight: bold;
    background-color: #ffffff;
    }
    /* End of additional theme styles */

    /* --- Media Queries for Mobile Responsiveness --- */
    @media screen and (max-width: 800px) { /* Adjusting based on new menu breakpoint */
      /* New Theme Navbar Mobile Styles */
      #menu {position:relative}
      #menu ul {background:#444444;position:absolute;top:100%;right:0;left:0;z-index:3;height:auto;display:none;text-align:left;}
      #menu ul.sub-menus {width:100%;position:static;}
      #menu ul.sub-menus a {padding-left:30px;}
      #menu li {display:block;float:none;width:auto;}
      #menu input, #menu label {position:absolute;top:0;left:0;display:block}
      #menu input {z-index:4}
      #menu input:checked + label {color:#FFFFFF}
      #menu input:checked + label:before {content:"\00d7"}
      #menu input:checked ~ ul {display:block}
      /* End New Theme Navbar Mobile Styles */

      #title h1 {
        font-size: 1.5em; /* Smaller title on mobile */
      }
      #title h2 {
        font-size: 1em; /* Smaller explanation on mobile */
      }
      #title h2:after { /* Adjust underline for mobile */
        width: 90%;
      }

      #search-container {
        left: 50%; /* Center horizontally */
        right: auto; /* Override right: 10px */
        transform: translateX(-50%); /* Adjust for centering */
        width: 90%; /* Make it wider to fill more of the screen */
        max-width: 350px; /* Prevent it from becoming too wide on larger phones/small tablets */
      }

      #search-results {
        max-height: 150px; /* Slightly reduce max height on smaller screens */
      }
    }

    @media screen and (max-width: 480px) { /* Further adjustments for very small screens (e.g., older phones) */
        #title h1 {
            font-size: 1.3em;
        }
        #title h2 {
            font-size: 0.9em;
        }
        #search-container {
            top: 5px; /* Move slightly higher */
            padding: 5px;
            width: 95%; /* Even wider */
        }
        #search-input {
            padding: 4px 8px; /* Smaller padding */
            font-size: 0.9em;
        }
        #search-button {
            padding: 4px 10px; /* Smaller padding */
            font-size: 0.9em;
        }
        #coordinate-tooltip {
            font-size: 0.75em; /* Smaller font for tooltip */
        }
    }
  </style>
</head>
<body>
  <div id="top-banner"></div>

  <nav id='menu'>
    <input type='checkbox' id='responsive-menu' onclick='updatemenu()'><label for='responsive-menu'></label>
    <ul>
      <li><a href='https://aaronperry-dev.github.io/'>Home</a></li>
      <li><a href='/about'>About</a></li>
      <li><a href='https://www.linkedin.com/in/aaronperry-0012d156/'>LinkedIn</a></li>
      <li><a href='/sentinel2'>Sentinel-2 L2A Imagery</a></li>
      <li><a href='/WMNF_Prohibited_Camping'>Prohibitive WMNF Camping Areas</a></li>
      </ul>
  </nav>

  <div id="title">
    <h1>Prohibitive Camping Areas in NH's White Mountains</h1>
    <h2><span style="color: red;">&#9632;</span> Red shaded areas indicate locations where dispersed/backcountry camping is strictly prohibited.</h2>
  </div>

  <div id="main-content">
    <div id="map">
      <div id="search-container">
        <div id="search-input-group">
          <input type="text" id="search-input" placeholder="Search for a mountain or trail...">
          <button id="search-button">Go</button>
        </div>
        <div id="search-results">
            <ul></ul>
        </div>
      </div>
      <div id="coordinate-tooltip"></div>
    </div>
    <div id="legend">
      <h3>Camping Regulations</h3>
      <ul>
        <li>Camp at least **200 ft** from trails and water bodies.</li>
        <li>Camp at least **1/4 mile** from backcountry facilities (shelters, huts, trailheads).</li>
        <li>No camping in the alpine zone (trees $\le$8 ft) except when $\ge$2 ft of snow cover.</li>
        <li>Camp at least **1/4 mile** from designated roads.</li>
      </ul>
    </div>
  </div>

  <footer id="footer">
    <p>Map and content by Aaron Perry.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/ol@v10.6.0/dist/ol.js"></script>
  <script>
    // JavaScript function to toggle the mobile menu display
    function updatemenu() {
      const responsiveMenuCheckbox = document.getElementById('responsive-menu');
      const menuUl = document.querySelector('#menu ul');
      if (responsiveMenuCheckbox && menuUl) {
        // The CSS media query handles the `display: none` by default for larger screens.
        // For mobile, when checked, it should display, otherwise hide.
        if (responsiveMenuCheckbox.checked) {
          menuUl.style.display = 'block';
        } else {
          // Reset to default (which will be 'none' on mobile due to CSS media query)
          menuUl.style.display = '';
        }
      }
    }

    window.onload = function() {
      // Validate OpenLayers global
      if (typeof ol === "undefined") {
        console.error("OpenLayers library not found. Make sure the script src is correct and served over HTTP/HTTPS.");
        return;
      }

      // Common style for GeoJSON layers
      const geojsonStyle = new ol.style.Style({
        fill: new ol.style.Fill({ color: 'rgba(255, 0, 0, 0.5)' }),
        stroke: new ol.style.Stroke({ color: 'red', width: 2 })
      });

      // Factory for vector layers
      function createGeojsonLayer(url) {
        return new ol.layer.Vector({
          source: new ol.source.Vector({ url: url, format: new ol.format.GeoJSON() }),
          style: geojsonStyle
        });
      }

      // Define the Gaia GPS USFS Classic basemap
      const gaiaUsfsBasemap = new ol.layer.Tile({
        source: new ol.source.XYZ({
          attributions: 'Tiles &copy; <a href="https://www.gaiagps.com/">Gaia GPS</a> / USFS Classic',
          url: 'https://statictiles.gaiagps.com/usfs-classic/{z}/{x}/{y}.png',
          minZoom: 0,
          maxZoom: 18
        })
      });

      // Define layers, starting with the Gaia GPS basemap
      const layers = [
        gaiaUsfsBasemap,
        createGeojsonLayer('simplified_SE.geojson'),
        createGeojsonLayer('simplified_SW.geojson'),
        createGeojsonLayer('simplified_NE.geojson'),
        createGeojsonLayer('simplified_NW.geojson')
      ];

      // Initialize map
      const map = new ol.Map({
        target: 'map',
        layers: layers,
        view: new ol.View({
          center: ol.proj.fromLonLat([-71.30, 44.27]), // Mount Washington
          zoom: 11
        })
      });

      // --- Search Bar Logic ---
      const searchInput = document.getElementById('search-input');
      const searchButton = document.getElementById('search-button');
      const searchResultsDiv = document.getElementById('search-results');
      const searchResultsList = searchResultsDiv.querySelector('ul');
      const searchContainer = document.getElementById('search-container');

      // Debounce function to limit API calls
      function debounce(func, delay) {
        let timeout;
        return function(...args) {
          const context = this;
          clearTimeout(timeout);
          timeout = setTimeout(() => func.apply(context, args), delay);
        };
      }

      // Function to perform geocoding
      async function geocodeAddress(query) {
        if (query.length < 3) {
            searchResultsDiv.style.display = 'none';
            return [];
        }
        const viewbox = "-71.7,43.8,-71.0,44.6";
        const nominatimUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5&addressdetails=1&viewbox=${viewbox}&bounded=1`;

        try {
          const response = await fetch(nominatimUrl, {
              headers: {
                  'User-Agent': 'ProhibitiveCampingMap/1.0 (your-email@example.com)' // REPLACE WITH YOUR EMAIL!
              }
          });
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.json();
          return data;
        } catch (error) {
          console.error("Error during geocoding:", error);
          return [];
        }
      }

      // Function to zoom to a location
      function zoomToLocation(lon, lat, zoomLevel = 14) {
        const view = map.getView();
        const coords = ol.proj.fromLonLat([parseFloat(lon), parseFloat(lat)]);
        view.animate({
          center: coords,
          zoom: zoomLevel,
          duration: 1000
        });
      }

      // Display search results
      function displaySearchResults(results) {
        searchResultsList.innerHTML = '';
        if (results && results.length > 0) {
          results.forEach(result => {
            const li = document.createElement('li');
            const displayName = result.display_name;
            li.textContent = displayName;
            li.dataset.lon = result.lon;
            li.dataset.lat = result.lat;
            li.addEventListener('click', () => {
              zoomToLocation(result.lon, result.lat);
              searchResultsDiv.style.display = 'none';
              searchInput.value = displayName;
            });
            searchResultsList.appendChild(li);
          });
          searchResultsDiv.style.display = 'block';
        } else {
          const li = document.createElement('li');
          li.textContent = "No results found.";
          searchResultsList.appendChild(li);
          searchResultsDiv.style.display = 'block';
        }
      }

      // --- Event Listeners for Search ---
      searchInput.addEventListener('input', debounce(async () => {
        const query = searchInput.value.trim();
        if (query.length > 2) {
          const results = await geocodeAddress(query);
          displaySearchResults(results);
        } else {
          searchResultsDiv.style.display = 'none';
        }
      }, 300));

      searchButton.addEventListener('click', async () => {
        const query = searchInput.value.trim();
        if (query) {
          const results = await geocodeAddress(query);
          displaySearchResults(results);
          if (results.length === 1) {
              zoomToLocation(results[0].lon, results[0].lat);
              searchResultsDiv.style.display = 'none';
          }
        }
      });

      searchInput.addEventListener('keypress', async (event) => {
        if (event.key === 'Enter') {
          event.preventDefault();
          if (searchResultsList.children.length > 0 && searchResultsDiv.style.display === 'block') {
            searchResultsList.children[0].click();
          } else {
            const query = searchInput.value.trim();
            if (query) {
                const results = await geocodeAddress(query);
                displaySearchResults(results);
                if (results.length > 0) {
                    zoomToLocation(results[0].lon, results[0].lat);
                    searchResultsDiv.style.display = 'none';
                }
            }
          }
        }
      });

      document.addEventListener('click', (event) => {
        if (!searchContainer.contains(event.target) && !searchResultsDiv.contains(event.target)) {
          searchResultsDiv.style.display = 'none';
        }
      });
      searchInput.addEventListener('focus', () => {
          if (searchResultsList.children.length > 0 && searchResultsList.children[0].textContent !== "No results found.") {
              searchResultsDiv.style.display = 'block';
          }
      });


      // --- Coordinate Tooltip Logic ---
      const coordinateTooltipElement = document.getElementById('coordinate-tooltip');

      const coordinateOverlay = new ol.Overlay({
          element: coordinateTooltipElement,
          offset: [0, -15],
          positioning: 'bottom-center'
      });
      map.addOverlay(coordinateOverlay);

      map.on('pointermove', function(event) {
          const coordinate = event.coordinate;
          const lonLat = ol.proj.toLonLat(coordinate);

          const lat = lonLat[1].toFixed(4);
          const lon = lonLat[0].toFixed(4);
          coordinateTooltipElement.innerHTML = `${lat}, ${lon}`;

          coordinateOverlay.setPosition(coordinate);
          coordinateTooltipElement.style.display = 'block';
      });

      map.getViewport().addEventListener('mouseout', function() {
          coordinateTooltipElement.style.display = 'none';
      });
    };
  </script>
</body>
</html>
