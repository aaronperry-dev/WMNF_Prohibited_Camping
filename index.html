<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prohibitive Camping Areas in NH's White Mountains</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.6.0/ol.css">
  <style>
    html, body { margin: 0; padding: 0; height: 100%; display: flex; flex-direction: column; }
    #title { text-align: center; padding: 10px; font-family: sans-serif; font-size: 1.5em; }
    #map { flex: 1; position: relative; } /* Added position: relative for search bar positioning */
    #legend { padding: 10px; background: #f9f9f9; font-family: sans-serif; }
    #legend h3 { margin-top: 0; }
    #legend ul { margin: 0; padding-left: 20px; }

    /* Search Bar Styling */
    #search-container {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000; /* Ensure it's above the map */
      background-color: rgba(255, 255, 255, 0.8);
      padding: 8px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      display: flex;
      gap: 5px; /* Space between input and button */
    }
    #search-input {
      border: 1px solid #ccc;
      padding: 6px 10px;
      font-size: 1em;
      border-radius: 3px;
      width: 200px; /* Adjust width as needed */
    }
    #search-button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 1em;
    }
    #search-button:hover {
      background-color: #0056b3;
    }
    #search-results {
        position: absolute;
        top: 45px; /* Adjust based on input height + padding */
        right: 10px;
        width: 216px; /* Match search input width + padding */
        background-color: white;
        border: 1px solid #ccc;
        border-top: none;
        border-radius: 0 0 5px 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        max-height: 200px;
        overflow-y: auto;
        display: none; /* Hidden by default */
        z-index: 999;
    }
    #search-results ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    #search-results li {
        padding: 8px 10px;
        cursor: pointer;
        border-bottom: 1px solid #eee;
    }
    #search-results li:last-child {
        border-bottom: none;
    }
    #search-results li:hover {
        background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <div id="title">Prohibitive Camping Areas in NH's White Mountains</div>
  <div id="map">
    <div id="search-container">
      <input type="text" id="search-input" placeholder="Search for a mountain or trail...">
      <button id="search-button">Go</button>
    </div>
    <div id="search-results">
        <ul></ul>
    </div>
  </div>
  <div id="legend">
    <h3>Camping Regulations</h3>
    <ul>
      <li>Camp at least <strong>200 ft</strong> from trails and water bodies.</li>
      <li>Camp at least <strong>1/4 mile</strong> from backcountry facilities (shelters, huts, trailheads).</li>
      <li>No camping in the alpine zone (trees &le;8 ft) except when &ge;2 ft of snow cover.</li>
      <li>Camp at least <strong>1/4 mile</strong> from designated roads.</li>
    </ul>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/ol@v10.6.0/dist/ol.js"></script>
  <script>
    window.onload = function() {
      // Validate OpenLayers global
      if (typeof ol === "undefined") {
        console.error("OpenLayers library not found. Make sure the script src is correct and served over HTTP/HTTPS.");
        return;
      }

      // Common style for GeoJSON layers
      const geojsonStyle = new ol.style.Style({
        fill: new ol.style.Fill({ color: 'rgba(255, 0, 0, 0.5)' }),
        stroke: new ol.style.Stroke({ color: 'red', width: 2 })
      });

      // Factory for vector layers
      function createGeojsonLayer(url) {
        return new ol.layer.Vector({
          source: new ol.source.Vector({ url: url, format: new ol.format.GeoJSON() }),
          style: geojsonStyle
        });
      }

      // Define the Gaia GPS USFS Classic basemap
      const gaiaUsfsBasemap = new ol.layer.Tile({
        source: new ol.source.XYZ({
          attributions: 'Tiles &copy; <a href="https://www.gaiagps.com/">Gaia GPS</a> / USFS Classic',
          url: 'https://statictiles.gaiagps.com/usfs-classic/{z}/{x}/{y}.png',
          minZoom: 0,
          maxZoom: 18
        })
      });

      // Define layers, starting with the Gaia GPS basemap
      const layers = [
        gaiaUsfsBasemap,
        createGeojsonLayer('simplified_SE.geojson'),
        createGeojsonLayer('simplified_SW.geojson'),
        createGeojsonLayer('simplified_NE.geojson'),
        createGeojsonLayer('simplified_NW.geojson')
      ];

      // Initialize map
      const map = new ol.Map({
        target: 'map',
        layers: layers,
        view: new ol.View({
          center: ol.proj.fromLonLat([-71.30, 44.27]), // Mount Washington
          zoom: 11
        })
      });

      // --- Search Bar Logic ---
      const searchInput = document.getElementById('search-input');
      const searchButton = document.getElementById('search-button');
      const searchResultsDiv = document.getElementById('search-results');
      const searchResultsList = searchResultsDiv.querySelector('ul');

      // Function to perform geocoding
      async function geocodeAddress(query) {
        const nominatimUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5&addressdetails=1`;

        try {
          const response = await fetch(nominatimUrl, {
              headers: {
                  // It's good practice to provide a User-Agent for Nominatim requests
                  // Replace 'YourAppName/1.0 (your-email@example.com)' with something relevant to your project.
                  // This is a requirement for Nominatim usage.
                  'User-Agent': 'ProhibitiveCampingMap/1.0 (your-email@example.com)'
              }
          });
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.json();
          return data;
        } catch (error) {
          console.error("Error during geocoding:", error);
          return [];
        }
      }

      // Function to zoom to a location
      function zoomToLocation(lon, lat, zoomLevel = 14) { // Default zoom to 14 for specific locations
        const view = map.getView();
        const coords = ol.proj.fromLonLat([parseFloat(lon), parseFloat(lat)]);
        view.animate({
          center: coords,
          zoom: zoomLevel,
          duration: 1000 // Smooth animation
        });
      }

      // Handle search button click
      searchButton.addEventListener('click', async () => {
        const query = searchInput.value.trim();
        if (query) {
          const results = await geocodeAddress(query + ", White Mountains, NH"); // Add context
          displaySearchResults(results);
        }
      });

      // Handle Enter key in search input
      searchInput.addEventListener('keypress', async (event) => {
        if (event.key === 'Enter') {
          const query = searchInput.value.trim();
          if (query) {
            const results = await geocodeAddress(query + ", White Mountains, NH"); // Add context
            displaySearchResults(results);
          }
        }
      });

      // Display search results
      function displaySearchResults(results) {
        searchResultsList.innerHTML = ''; // Clear previous results
        if (results && results.length > 0) {
          results.forEach(result => {
            const li = document.createElement('li');
            li.textContent = result.display_name;
            li.dataset.lon = result.lon;
            li.dataset.lat = result.lat;
            li.addEventListener('click', () => {
              zoomToLocation(result.lon, result.lat);
              searchResultsDiv.style.display = 'none'; // Hide results after selection
              searchInput.value = result.display_name; // Put selected name in input
            });
            searchResultsList.appendChild(li);
          });
          searchResultsDiv.style.display = 'block'; // Show results div
        } else {
          const li = document.createElement('li');
          li.textContent = "No results found.";
          searchResultsList.appendChild(li);
          searchResultsDiv.style.display = 'block'; // Show "No results" message
        }
      }

      // Hide search results when clicking outside
      document.addEventListener('click', (event) => {
        if (!searchContainer.contains(event.target) && !searchResultsDiv.contains(event.target)) {
          searchResultsDiv.style.display = 'none';
        }
      });
      // Show results again if input is focused and results are available
      searchInput.addEventListener('focus', () => {
          if (searchResultsList.children.length > 0 && searchResultsList.children[0].textContent !== "No results found.") {
              searchResultsDiv.style.display = 'block';
          }
      });

      // Get reference to search container for click outside logic
      const searchContainer = document.getElementById('search-container');
    };
  </script>
</body>
</html>
